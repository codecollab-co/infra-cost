# Example: Multi-Cloud Cost Analysis
# Analyze costs across AWS, GCP, and Azure

name: Multi-Cloud Cost Analysis

on:
  schedule:
    # Run every day at 6 AM UTC
    - cron: '0 6 * * *'
  workflow_dispatch:

jobs:
  aws-costs:
    runs-on: ubuntu-latest
    steps:
      - name: AWS Cost Analysis
        uses: codecollab-co/infra-cost@v0.3.0
        with:
          provider: aws
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          analysis-type: summary
          output-format: json

  gcp-costs:
    runs-on: ubuntu-latest
    steps:
      - name: GCP Cost Analysis
        uses: codecollab-co/infra-cost@v0.3.0
        with:
          provider: gcp
          gcp-project-id: ${{ secrets.GCP_PROJECT_ID }}
          gcp-key-file: ${{ secrets.GCP_KEY_FILE }}
          analysis-type: summary
          output-format: json

  azure-costs:
    runs-on: ubuntu-latest
    steps:
      - name: Azure Cost Analysis
        uses: codecollab-co/infra-cost@v0.3.0
        with:
          provider: azure
          azure-subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
          azure-tenant-id: ${{ secrets.AZURE_TENANT_ID }}
          azure-client-id: ${{ secrets.AZURE_CLIENT_ID }}
          azure-client-secret: ${{ secrets.AZURE_CLIENT_SECRET }}
          analysis-type: summary
          output-format: json

  notify:
    needs: [aws-costs, gcp-costs, azure-costs]
    runs-on: ubuntu-latest
    steps:
      - name: Send Summary to Slack
        run: |
          curl -X POST -H 'Content-type: application/json' \
            --data '{"text": "Multi-cloud cost analysis complete. Check the workflow for details."}' \
            ${{ secrets.SLACK_WEBHOOK }}
